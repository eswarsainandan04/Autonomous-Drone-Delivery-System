<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShadowFly - Admin Login</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <main>
        <div id="flash-messages"></div>
        
        <div class="login-container">
            <div class="login-form-container">
                <form id="adminLoginForm">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" name="username" required class="form-control" placeholder="Enter admin username">
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" name="password" required class="form-control" placeholder="Enter password">
                    </div>
                    <button type="submit" class="btn primary-btn">Login</button>
                    <div class="form-footer">
                        <a href="{{ url_for('index') }}" class="btn secondary-btn">Back to Home</a>
                    </div>
                </form>
            </div>
            
            <div class="input-panel">
                <div id="keyboard" class="virtual-keyboard">
                    <!-- Keyboard will be generated by JavaScript -->
                </div>
            </div>
        </div>
    </main>

    <script>
document.addEventListener('DOMContentLoaded', function() {
    const keyboard = {
        'row1': '1234567890',
        'row2': 'qwertyuiop',
        'row3': 'asdfghjkl',
        'row4': 'zxcvbnm'
    };

    const keyboardContainer = document.getElementById('keyboard');
    const flashMessages = document.getElementById('flash-messages');
    const adminLoginForm = document.getElementById('adminLoginForm');
    let currentInput = null;

    function showFlashMessage(message, type = 'error') {
        flashMessages.innerHTML = `<div class="flash-message ${type}">${message}</div>`;
        setTimeout(() => {
            flashMessages.innerHTML = '';
        }, 5000);
    }

    // Create keyboard layout
    Object.values(keyboard).forEach(row => {
        const rowDiv = document.createElement('div');
        rowDiv.className = 'keyboard-row';
        
        [...row].forEach(key => {
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'keyboard-key';
            btn.textContent = key;
            btn.dataset.key = key;
            rowDiv.appendChild(btn);
        });
        
        keyboardContainer.appendChild(rowDiv);
    });

    // Add special keys row
    const specialRow = document.createElement('div');
    specialRow.className = 'keyboard-row';

    // Backspace key
    const backspace = document.createElement('button');
    backspace.type = 'button';
    backspace.className = 'keyboard-key special-key';
    backspace.textContent = 'âŒ«';
    backspace.dataset.key = 'backspace';
    specialRow.appendChild(backspace);

    // Space key
    const space = document.createElement('button');
    space.type = 'button';
    space.className = 'keyboard-key space-key';
    space.textContent = 'Space';
    space.dataset.key = ' ';
    specialRow.appendChild(space);

    keyboardContainer.appendChild(specialRow);

    // Handle input focus
    document.querySelectorAll('input').forEach(input => {
        input.addEventListener('focus', function () {
            currentInput = this;
        });
    });

    // Handle keyboard clicks
    keyboardContainer.addEventListener('click', function(e) {
        if (!currentInput) return;
        
        const key = e.target;
        if (key.classList.contains('keyboard-key')) {
            if (key.classList.contains('special-key')) {
                // Backspace
                currentInput.value = currentInput.value.slice(0, -1);
            } else if (key.classList.contains('space-key')) {
                // Space
                currentInput.value += ' ';
            } else {
                currentInput.value += key.dataset.key;
            }
            currentInput.focus();
        }
    });

    // Handle form submission
    adminLoginForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        try {
            const response = await fetch('/validate-admin', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ username, password })
            });

            const data = await response.json();

            if (data.success) {
                showFlashMessage('Login successful! Redirecting...', 'success');
                setTimeout(() => {
                    window.location.href = "{{ url_for('dashboard') }}";
                }, 1000);
            } else {
                showFlashMessage(data.message || 'Invalid username or password.');
            }
        } catch (error) {
            console.error('Login error:', error);
            showFlashMessage('An error occurred. Please try again.');
        }
    });

    // Set initial focus
    document.getElementById('username').focus();
});
</script>
</body>
</html>
